import{MagicPayloadMethod as e,RPCErrorCode as t,SDKErrorCode as r,SDKWarningCode as s,MagicOutgoingWindowMessage as n,MagicIncomingWindowMessage as o}from"@magic-sdk/types";const i={SEMVER_SPEC_VERSION:"2.0.0",MAX_LENGTH:256,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991,MAX_SAFE_COMPONENT_LENGTH:16},a="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{},c=function(e){const t={exports:{}};return function(e,t){const{MAX_SAFE_COMPONENT_LENGTH:r}=i,s=(t=e.exports={}).re=[],n=t.src=[],o=t.t={};let c=0;const l=(e,t,r)=>{const i=c++;a(i,t),o[e]=i,n[i]=t,s[i]=new RegExp(t,r?"g":void 0)};l("NUMERICIDENTIFIER","0|[1-9]\\d*"),l("NUMERICIDENTIFIERLOOSE","[0-9]+"),l("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),l("MAINVERSION",`(${n[o.NUMERICIDENTIFIER]})\\.(${n[o.NUMERICIDENTIFIER]})\\.(${n[o.NUMERICIDENTIFIER]})`),l("MAINVERSIONLOOSE",`(${n[o.NUMERICIDENTIFIERLOOSE]})\\.(${n[o.NUMERICIDENTIFIERLOOSE]})\\.(${n[o.NUMERICIDENTIFIERLOOSE]})`),l("PRERELEASEIDENTIFIER",`(?:${n[o.NUMERICIDENTIFIER]}|${n[o.NONNUMERICIDENTIFIER]})`),l("PRERELEASEIDENTIFIERLOOSE",`(?:${n[o.NUMERICIDENTIFIERLOOSE]}|${n[o.NONNUMERICIDENTIFIER]})`),l("PRERELEASE",`(?:-(${n[o.PRERELEASEIDENTIFIER]}(?:\\.${n[o.PRERELEASEIDENTIFIER]})*))`),l("PRERELEASELOOSE",`(?:-?(${n[o.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${n[o.PRERELEASEIDENTIFIERLOOSE]})*))`),l("BUILDIDENTIFIER","[0-9A-Za-z-]+"),l("BUILD",`(?:\\+(${n[o.BUILDIDENTIFIER]}(?:\\.${n[o.BUILDIDENTIFIER]})*))`),l("FULLPLAIN",`v?${n[o.MAINVERSION]}${n[o.PRERELEASE]}?${n[o.BUILD]}?`),l("FULL",`^${n[o.FULLPLAIN]}$`),l("LOOSEPLAIN",`[v=\\s]*${n[o.MAINVERSIONLOOSE]}${n[o.PRERELEASELOOSE]}?${n[o.BUILD]}?`),l("LOOSE",`^${n[o.LOOSEPLAIN]}$`),l("GTLT","((?:<|>)?=?)"),l("XRANGEIDENTIFIERLOOSE",`${n[o.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),l("XRANGEIDENTIFIER",`${n[o.NUMERICIDENTIFIER]}|x|X|\\*`),l("XRANGEPLAIN",`[v=\\s]*(${n[o.XRANGEIDENTIFIER]})(?:\\.(${n[o.XRANGEIDENTIFIER]})(?:\\.(${n[o.XRANGEIDENTIFIER]})(?:${n[o.PRERELEASE]})?${n[o.BUILD]}?)?)?`),l("XRANGEPLAINLOOSE",`[v=\\s]*(${n[o.XRANGEIDENTIFIERLOOSE]})(?:\\.(${n[o.XRANGEIDENTIFIERLOOSE]})(?:\\.(${n[o.XRANGEIDENTIFIERLOOSE]})(?:${n[o.PRERELEASELOOSE]})?${n[o.BUILD]}?)?)?`),l("XRANGE",`^${n[o.GTLT]}\\s*${n[o.XRANGEPLAIN]}$`),l("XRANGELOOSE",`^${n[o.GTLT]}\\s*${n[o.XRANGEPLAINLOOSE]}$`),l("COERCE",`(^|[^\\d])(\\d{1,${r}})(?:\\.(\\d{1,${r}}))?(?:\\.(\\d{1,${r}}))?(?:$|[^\\d])`),l("COERCERTL",n[o.COERCE],!0),l("LONETILDE","(?:~>?)"),l("TILDETRIM",`(\\s*)${n[o.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",l("TILDE",`^${n[o.LONETILDE]}${n[o.XRANGEPLAIN]}$`),l("TILDELOOSE",`^${n[o.LONETILDE]}${n[o.XRANGEPLAINLOOSE]}$`),l("LONECARET","(?:\\^)"),l("CARETTRIM",`(\\s*)${n[o.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",l("CARET",`^${n[o.LONECARET]}${n[o.XRANGEPLAIN]}$`),l("CARETLOOSE",`^${n[o.LONECARET]}${n[o.XRANGEPLAINLOOSE]}$`),l("COMPARATORLOOSE",`^${n[o.GTLT]}\\s*(${n[o.LOOSEPLAIN]})$|^$`),l("COMPARATOR",`^${n[o.GTLT]}\\s*(${n[o.FULLPLAIN]})$|^$`),l("COMPARATORTRIM",`(\\s*)${n[o.GTLT]}\\s*(${n[o.LOOSEPLAIN]}|${n[o.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",l("HYPHENRANGE",`^\\s*(${n[o.XRANGEPLAIN]})\\s+-\\s+(${n[o.XRANGEPLAIN]})\\s*$`),l("HYPHENRANGELOOSE",`^\\s*(${n[o.XRANGEPLAINLOOSE]})\\s+-\\s+(${n[o.XRANGEPLAINLOOSE]})\\s*$`),l("STAR","(<|>)?=?\\s*\\*"),l("GTE0","^\\s*>=\\s*0.0.0\\s*$"),l("GTE0PRE","^\\s*>=\\s*0.0.0-0\\s*$")}(t,t.exports),t.exports}(),l=/^[0-9]+$/,h=(e,t)=>{const r=l.test(e),s=l.test(t);return r&&s&&(e=+e,t=+t),e===t?0:r&&!s?-1:s&&!r?1:e<t?-1:1},p={compareIdentifiers:h,rcompareIdentifiers:(e,t)=>h(t,e)},{MAX_LENGTH:u,MAX_SAFE_INTEGER:d}=i,{re:E,t:f}=c,{compareIdentifiers:m}=p;class v{constructor(e,t){if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof v){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw new TypeError(`Invalid Version: ${e}`);if(e.length>u)throw new TypeError(`version is longer than ${u} characters`);a("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const r=e.trim().match(t.loose?E[f.LOOSE]:E[f.FULL]);if(!r)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>d||this.major<0)throw new TypeError("Invalid major version");if(this.minor>d||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>d||this.patch<0)throw new TypeError("Invalid patch version");this.prerelease=r[4]?r[4].split(".").map(e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<d)return t}return e}):[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(a("SemVer.compare",this.version,this.options,e),!(e instanceof v)){if("string"==typeof e&&e===this.version)return 0;e=new v(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof v||(e=new v(e,this.options)),m(this.major,e.major)||m(this.minor,e.minor)||m(this.patch,e.patch)}comparePre(e){if(e instanceof v||(e=new v(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const r=this.prerelease[t],s=e.prerelease[t];if(a("prerelease compare",t,r,s),void 0===r&&void 0===s)return 0;if(void 0===s)return 1;if(void 0===r)return-1;if(r!==s)return m(r,s)}while(++t)}compareBuild(e){e instanceof v||(e=new v(e,this.options));let t=0;do{const r=this.build[t],s=e.build[t];if(a("prerelease compare",t,r,s),void 0===r&&void 0===s)return 0;if(void 0===s)return 1;if(void 0===r)return-1;if(r!==s)return m(r,s)}while(++t)}inc(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{let e=this.prerelease.length;for(;--e>=0;)"number"==typeof this.prerelease[e]&&(this.prerelease[e]++,e=-2);-1===e&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error(`invalid increment argument: ${e}`)}return this.format(),this.raw=this.version,this}}const I=(e,t,r)=>new v(e,r).compare(new v(t,r)),$=(e,t,r,s)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e===r;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e!==r;case"":case"=":case"==":return((e,t,r)=>0===I(e,t,r))(e,r,s);case"!=":return((e,t,r)=>0!==I(e,t,r))(e,r,s);case">":return((e,t,r)=>I(e,t,r)>0)(e,r,s);case">=":return((e,t,r)=>I(e,t,r)>=0)(e,r,s);case"<":return((e,t,r)=>I(e,t,r)<0)(e,r,s);case"<=":return((e,t,r)=>I(e,t,r)<=0)(e,r,s);default:throw new TypeError(`Invalid operator: ${t}`)}},y=Symbol("SemVer ANY");class g{static get ANY(){return y}constructor(e,t){if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof g){if(e.loose===!!t.loose)return e;e=e.value}a("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.value=this.semver===y?"":this.operator+this.semver.version,a("comp",this)}parse(e){const t=e.match(this.options.loose?R[_.COMPARATORLOOSE]:R[_.COMPARATOR]);if(!t)throw new TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==t[1]?t[1]:"","="===this.operator&&(this.operator=""),this.semver=t[2]?new v(t[2],this.options.loose):y}toString(){return this.value}test(e){if(a("Comparator.test",e,this.options.loose),this.semver===y||e===y)return!0;if("string"==typeof e)try{e=new v(e,this.options)}catch(e){return!1}return $(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof g))throw new TypeError("a Comparator is required");if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),""===this.operator)return""===this.value||new w(e.value,t).test(this.value);if(""===e.operator)return""===e.value||new w(this.value,t).test(e.semver);const r=!(">="!==this.operator&&">"!==this.operator||">="!==e.operator&&">"!==e.operator),s=!("<="!==this.operator&&"<"!==this.operator||"<="!==e.operator&&"<"!==e.operator),n=this.semver.version===e.semver.version,o=!(">="!==this.operator&&"<="!==this.operator||">="!==e.operator&&"<="!==e.operator),i=$(this.semver,"<",e.semver,t)&&(">="===this.operator||">"===this.operator)&&("<="===e.operator||"<"===e.operator),a=$(this.semver,">",e.semver,t)&&("<="===this.operator||"<"===this.operator)&&(">="===e.operator||">"===e.operator);return r||s||n&&o||i||a}}const{re:R,t:_}=c;class w{constructor(e,t){if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof w)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new w(e.raw,t);if(e instanceof g)return this.raw=e.value,this.set=[[e]],this.format(),this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e,this.set=e.split(/\s*\|\|\s*/).map(e=>this.parseRange(e.trim())).filter(e=>e.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${e}`);this.format()}format(){return this.range=this.set.map(e=>e.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(e){const{loose:t}=this.options;e=(e=e.trim()).replace(t?O[N.HYPHENRANGELOOSE]:O[N.HYPHENRANGE],F(this.options.includePrerelease)),a("hyphen replace",e),e=e.replace(O[N.COMPARATORTRIM],A),a("comparator trim",e,O[N.COMPARATORTRIM]),e=(e=(e=e.replace(O[N.TILDETRIM],T)).replace(O[N.CARETTRIM],L)).split(/\s+/).join(" ");const r=t?O[N.COMPARATORLOOSE]:O[N.COMPARATOR];return e.split(" ").map(e=>M(e,this.options)).join(" ").split(/\s+/).map(e=>U(e,this.options)).filter(this.options.loose?e=>!!e.match(r):()=>!0).map(e=>new g(e,this.options))}intersects(e,t){if(!(e instanceof w))throw new TypeError("a Range is required");return this.set.some(r=>S(r,t)&&e.set.some(e=>S(e,t)&&r.every(r=>e.every(e=>r.intersects(e,t)))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new v(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(X(this.set[t],e,this.options))return!0;return!1}}const{re:O,t:N,comparatorTrimReplace:A,tildeTrimReplace:T,caretTrimReplace:L}=c,S=(e,t)=>{let r=!0;const s=e.slice();let n=s.pop();for(;r&&s.length;)r=s.every(e=>n.intersects(e,t)),n=s.pop();return r},M=(e,t)=>(a("comp",e,t),e=D(e,t),a("caret",e),e=C(e,t),a("tildes",e),e=x(e,t),a("xrange",e),e=G(e,t),a("stars",e),e),P=e=>!e||"x"===e.toLowerCase()||"*"===e,C=(e,t)=>e.trim().split(/\s+/).map(e=>b(e,t)).join(" "),b=(e,t)=>e.replace(t.loose?O[N.TILDELOOSE]:O[N.TILDE],(t,r,s,n,o)=>{let i;return a("tilde",e,t,r,s,n,o),P(r)?i="":P(s)?i=`>=${r}.0.0 <${+r+1}.0.0-0`:P(n)?i=`>=${r}.${s}.0 <${r}.${+s+1}.0-0`:o?(a("replaceTilde pr",o),i=`>=${r}.${s}.${n}-${o} <${r}.${+s+1}.0-0`):i=`>=${r}.${s}.${n} <${r}.${+s+1}.0-0`,a("tilde return",i),i}),D=(e,t)=>e.trim().split(/\s+/).map(e=>j(e,t)).join(" "),j=(e,t)=>{a("caret",e,t);const r=t.includePrerelease?"-0":"";return e.replace(t.loose?O[N.CARETLOOSE]:O[N.CARET],(t,s,n,o,i)=>{let c;return a("caret",e,t,s,n,o,i),P(s)?c="":P(n)?c=`>=${s}.0.0${r} <${+s+1}.0.0-0`:P(o)?c="0"===s?`>=${s}.${n}.0${r} <${s}.${+n+1}.0-0`:`>=${s}.${n}.0${r} <${+s+1}.0.0-0`:i?(a("replaceCaret pr",i),c="0"===s?"0"===n?`>=${s}.${n}.${o}-${i} <${s}.${n}.${+o+1}-0`:`>=${s}.${n}.${o}-${i} <${s}.${+n+1}.0-0`:`>=${s}.${n}.${o}-${i} <${+s+1}.0.0-0`):(a("no pr"),c="0"===s?"0"===n?`>=${s}.${n}.${o}${r} <${s}.${n}.${+o+1}-0`:`>=${s}.${n}.${o}${r} <${s}.${+n+1}.0-0`:`>=${s}.${n}.${o} <${+s+1}.0.0-0`),a("caret return",c),c})},x=(e,t)=>(a("replaceXRanges",e,t),e.split(/\s+/).map(e=>k(e,t)).join(" ")),k=(e,t)=>(e=e.trim()).replace(t.loose?O[N.XRANGELOOSE]:O[N.XRANGE],(r,s,n,o,i,c)=>{a("xRange",e,r,s,n,o,i,c);const l=P(n),h=l||P(o),p=h||P(i);return"="===s&&p&&(s=""),c=t.includePrerelease?"-0":"",l?r=">"===s||"<"===s?"<0.0.0-0":"*":s&&p?(h&&(o=0),i=0,">"===s?(s=">=",h?(n=+n+1,o=0,i=0):(o=+o+1,i=0)):"<="===s&&(s="<",h?n=+n+1:o=+o+1),"<"===s&&(c="-0"),r=`${s+n}.${o}.${i}${c}`):h?r=`>=${n}.0.0${c} <${+n+1}.0.0-0`:p&&(r=`>=${n}.${o}.0${c} <${n}.${+o+1}.0-0`),a("xRange return",r),r}),G=(e,t)=>(a("replaceStars",e,t),e.trim().replace(O[N.STAR],"")),U=(e,t)=>(a("replaceGTE0",e,t),e.trim().replace(O[t.includePrerelease?N.GTE0PRE:N.GTE0],"")),F=e=>(t,r,s,n,o,i,a,c,l,h,p,u,d)=>`${r=P(s)?"":P(n)?`>=${s}.0.0${e?"-0":""}`:P(o)?`>=${s}.${n}.0${e?"-0":""}`:i?`>=${r}`:`>=${r}${e?"-0":""}`} ${c=P(l)?"":P(h)?`<${+l+1}.0.0-0`:P(p)?`<${l}.${+h+1}.0-0`:u?`<=${l}.${h}.${p}-${u}`:e?`<${l}.${h}.${+p+1}-0`:`<=${c}`}`.trim(),X=(e,t,r)=>{for(let r=0;r<e.length;r++)if(!e[r].test(t))return!1;if(t.prerelease.length&&!r.includePrerelease){for(let r=0;r<e.length;r++)if(a(e[r].semver),e[r].semver!==g.ANY&&e[r].semver.prerelease.length>0){const s=e[r].semver;if(s.major===t.major&&s.minor===t.minor&&s.patch===t.patch)return!0}return!1}return!0},K=(e,t,r)=>{try{t=new w(t,r)}catch(e){return!1}return t.test(e)},{MAX_LENGTH:H}=i,{re:V,t:Y}=c,{re:W,t:q}=c,B=(e,t)=>{if(e instanceof v)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let r=null;if((t=t||{}).rtl){let t;for(;(t=W[q.COERCERTL].exec(e))&&(!r||r.index+r[0].length!==e.length);)r&&t.index+t[0].length===r.index+r[0].length||(r=t),W[q.COERCERTL].lastIndex=t.index+t[1].length+t[2].length;W[q.COERCERTL].lastIndex=-1}else r=e.match(W[q.COERCE]);return null===r?null:((e,t)=>{if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof v)return e;if("string"!=typeof e)return null;if(e.length>H)return null;if(!(t.loose?V[Y.LOOSE]:V[Y.FULL]).test(e))return null;try{return new v(e,t)}catch(e){return null}})(`${r[2]}.${r[3]||"0"}.${r[4]||"0"}`,t)};var J={__proto__:null,satisfies:K,coerce:B};function z(e){return String.fromCharCode(parseInt(e.slice(1),16))}function Q(e){return`%${`00${e.charCodeAt(0).toString(16)}`.slice(-2)}`}function Z(e){return t=JSON.stringify(e),btoa(encodeURIComponent(t).replace(/%[0-9A-F]{2}/g,z));var t}function ee(e){return JSON.parse(decodeURIComponent(Array.from(atob(e),Q).join("")))}function te(e){return void 0===e}function re(e){return function(e){return null===e}(e)||te(e)}function se(e){return!re(e)&&!(te(e.jsonrpc)||te(e.id)||te(e.method)||te(e.params))}function ne(e){return!re(e)&&!(te(e.jsonrpc)||te(e.id)||te(e.result)&&te(e.error))}function oe(t){return!re(t)&&"string"==typeof t&&Object.values(e).includes(t)}function ie(e){return!re(e)&&"number"==typeof e&&Object.values(t).includes(e)}function ae(e){if(!e)return!0;for(const t in e)if(Object.hasOwnProperty.call(e,t))return!1;return!0}const ce={};function le(e,t){return Object.assign(ce,t),e}const he={"magic-sdk":"magic-sdk","@magic-sdk/react-native":"magic-sdk-rn"};class pe extends Error{constructor(e,t){super(`Magic SDK Error: [${e}] ${t}`),this.code=void 0,this.rawMessage=void 0,this.__proto__=Error,this.code=e,this.rawMessage=t,Object.setPrototypeOf(this,pe.prototype)}}class ue extends Error{constructor(e){super(),this.__proto__=Error,this.code=void 0,this.rawMessage=void 0;const r=Number(null==e?void 0:e.code);this.rawMessage=(null==e?void 0:e.message)||"Internal error",this.code=ie(r)?r:t.InternalError,this.message=`Magic RPC Error: [${this.code}] ${this.rawMessage}`,Object.setPrototypeOf(this,ue.prototype)}}class de{constructor(e,t){this.code=void 0,this.rawMessage=void 0,this.message=void 0,this.code=e,this.rawMessage=t,this.message=`Magic SDK Warning: [${e}] ${t}`}log(){console.warn(this.message)}}class Ee extends Error{constructor(e,t,r,s){super(`Magic Extension Error (${e.name}): [${t}] ${r}`),this.code=void 0,this.rawMessage=void 0,this.data=void 0,this.__proto__=Error,this.code=t,this.rawMessage=r,this.data=s,Object.setPrototypeOf(this,Ee.prototype)}}class fe{constructor(e,t,r){this.code=void 0,this.rawMessage=void 0,this.message=void 0,this.code=t,this.rawMessage=r,this.message=`Magic Extension Warning (${e.name}): [${t}] ${r}`}log(){console.warn(this.message)}}function me(){return new pe(r.MissingApiKey,"Please provide an API key that you acquired from the Magic developer dashboard.")}function ve(){return new pe(r.ModalNotReady,"Modal is not ready.")}function Ie(){return new pe(r.MalformedResponse,"Response from the Magic iframe is malformed.")}function $e(e){return new pe(r.ExtensionNotInitialized,`Extensions must be initialized with a Magic SDK instance before \`Extension.${e}\` can be accessed. Do not invoke \`Extension.${e}\` inside an extension constructor.`)}function ye(e){let t=`Some extensions are incompatible with \`${ce.sdkName}@${ce.version}\`:`;return e.filter(e=>null!=e.compat).forEach(e=>{const r=e.compat[ce.sdkName];"string"==typeof r?t+=`\n  - Extension \`${e.name}\` supports version(s) \`${r}\``:r||(t+=`\n  - Extension \`${e.name}\` does not support ${ce.platform} environments.`)}),new pe(r.IncompatibleExtensions,t)}function ge(e){return new pe(r.InvalidArgument,`Invalid ${(e=>{const t=e+1,r=t%10,s=t%100;return 1===r&&11!==s?`${t}st`:2===r&&12!==s?`${t}nd`:3===r&&13!==s?`${t}rd`:`${t}th`})(e.argument)} argument given to \`${e.procedure}\`.\n  Expected: \`${e.expected}\`\n  Received: \`${e.received}\``)}function Re(){return new de(s.DuplicateIframe,"Duplicate iframes found.")}function _e(){return new de(s.SyncWeb3Method,"Non-async web3 methods are deprecated in web3 > 1.0 and are not supported by the Magic web3 provider. Please use an async method instead.")}function we(){return new de(s.ReactNativeEndpointConfiguration,`CUSTOM DOMAINS ARE NOT SUPPORTED WHEN USING MAGIC SDK WITH REACT NATIVE! The \`endpoint\` parameter SHOULD NOT be provided. The Magic \`<iframe>\` is automatically wrapped by a WebView pointed at \`${ce.defaultEndpoint}\`. Changing this default behavior will lead to unexpected results and potentially security-threatening bugs.`)}function Oe(e){const{method:t,removalVersions:r,useInstead:n}=e;return new de(s.DeprecationNotice,`\`${t}\` will be removed from \`${ce.sdkName}\` in version \`${r[ce.sdkName]}\`.${n?` Use \`${n}\` instead.`:""}`)}const Ne=function*(){let e=0;for(;;)e<Number.MAX_SAFE_INTEGER?yield++e:e=0}();function Ae(){return Ne.next().value}const Te=Symbol("Payload pre-processed by Magic SDK");function Le(e){return Object.defineProperty(e,Te,{value:!0,enumerable:!1}),e}function Se(e){var t,r,s;return function(e){return!!e[Te]}(e)||(e.jsonrpc=null!=(t=e.jsonrpc)?t:"2.0",e.id=Ae(),e.method=null!=(r=e.method)?r:"noop",e.params=null!=(s=e.params)?s:[],Le(e)),e}function Me(e,t=[]){return Le({params:t,method:e,jsonrpc:"2.0",id:Ae()})}class Pe{constructor(e){this._jsonrpc=void 0,this._id=void 0,this._result=void 0,this._error=void 0,e instanceof Pe?(this._jsonrpc=e.payload.jsonrpc,this._id=e.payload.id,this._result=e.payload.result,this._error=e.payload.error):ne(e)?(this._jsonrpc=e.jsonrpc,this._id=e.id,this._result=e.result,this._error=e.error):(this._jsonrpc=e.jsonrpc,this._id=e.id,this._result=void 0,this._error=void 0)}applyError(e){return this._error=e,this}applyResult(e){return this._result=e,this}get hasError(){return null!=this._error}get hasResult(){return void 0!==this._result}get payload(){return{jsonrpc:this._jsonrpc,id:this._id,result:this._result,error:this._error}}}var Ce,be=(function(e){var t=Object.prototype.hasOwnProperty,r="~";function s(){}function n(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function o(e,t,s,o,i){if("function"!=typeof s)throw new TypeError("The listener must be a function");var a=new n(s,o||e,i),c=r?r+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],a]:e._events[c].push(a):(e._events[c]=a,e._eventsCount++),e}function i(e,t){0==--e._eventsCount?e._events=new s:delete e._events[t]}function a(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(r=!1)),a.prototype.eventNames=function(){var e,s,n=[];if(0===this._eventsCount)return n;for(s in e=this._events)t.call(e,s)&&n.push(r?s.slice(1):s);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},a.prototype.listeners=function(e){var t=this._events[r?r+e:e];if(!t)return[];if(t.fn)return[t.fn];for(var s=0,n=t.length,o=new Array(n);s<n;s++)o[s]=t[s].fn;return o},a.prototype.listenerCount=function(e){var t=this._events[r?r+e:e];return t?t.fn?1:t.length:0},a.prototype.emit=function(e,t,s,n,o,i){var a=r?r+e:e;if(!this._events[a])return!1;var c,l,h=this._events[a],p=arguments.length;if(h.fn){switch(h.once&&this.removeListener(e,h.fn,void 0,!0),p){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,t),!0;case 3:return h.fn.call(h.context,t,s),!0;case 4:return h.fn.call(h.context,t,s,n),!0;case 5:return h.fn.call(h.context,t,s,n,o),!0;case 6:return h.fn.call(h.context,t,s,n,o,i),!0}for(l=1,c=new Array(p-1);l<p;l++)c[l-1]=arguments[l];h.fn.apply(h.context,c)}else{var u,d=h.length;for(l=0;l<d;l++)switch(h[l].once&&this.removeListener(e,h[l].fn,void 0,!0),p){case 1:h[l].fn.call(h[l].context);break;case 2:h[l].fn.call(h[l].context,t);break;case 3:h[l].fn.call(h[l].context,t,s);break;case 4:h[l].fn.call(h[l].context,t,s,n);break;default:if(!c)for(u=1,c=new Array(p-1);u<p;u++)c[u-1]=arguments[u];h[l].fn.apply(h[l].context,c)}}return!0},a.prototype.on=function(e,t,r){return o(this,e,t,r,!1)},a.prototype.once=function(e,t,r){return o(this,e,t,r,!0)},a.prototype.removeListener=function(e,t,s,n){var o=r?r+e:e;if(!this._events[o])return this;if(!t)return i(this,o),this;var a=this._events[o];if(a.fn)a.fn!==t||n&&!a.once||s&&a.context!==s||i(this,o);else{for(var c=0,l=[],h=a.length;c<h;c++)(a[c].fn!==t||n&&!a[c].once||s&&a[c].context!==s)&&l.push(a[c]);l.length?this._events[o]=1===l.length?l[0]:l:i(this,o)}return this},a.prototype.removeAllListeners=function(e){var t;return e?this._events[t=r?r+e:e]&&i(this,t):(this._events=new s,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a,e.exports=a}(Ce={exports:{}}),Ce.exports);class De extends be{}function je(){const e=new De;return{emitter:e,createChainingEmitterMethod:(t,r)=>(...s)=>(e[t].apply(e,s),r),createBoundEmitterMethod:t=>(...r)=>e[t].apply(e,r)}}const xe=Symbol("isPromiEvent");function ke(e){return!!e[xe]}function Ge(e){const t=Ue(e),{createBoundEmitterMethod:r,createChainingEmitterMethod:s}=je(),n=Symbol("Promise.then"),o=Symbol("Promise.catch"),i=Symbol("Promise.finally"),a=(e,t)=>(...r)=>{const s=t[e].apply(t,r);return c(s)},c=e=>Object.assign(e,{[xe]:!0,[n]:e[n]||e.then,[o]:e[o]||e.catch,[i]:e[i]||e.finally,then:a(n,e),catch:a(o,e),finally:a(i,e),on:s("on",e),once:s("once",e),addListener:s("addListener",e),off:s("off",e),removeListener:s("removeListener",e),removeAllListeners:s("removeAllListeners",e),emit:r("emit"),eventNames:r("eventNames"),listeners:r("listeners"),listenerCount:r("listenerCount")}),l=c(t.then(e=>(l.emit("done",e),l.emit("settled"),e),e=>{throw l.emit("error",e),l.emit("settled"),e}));return l}function Ue(e){return new Promise((t,r)=>{const s=e(t,r);Promise.resolve(s).catch(r)})}class Fe{constructor(e){this.sdk=void 0,this.sdk=e}get overlay(){return this.sdk.overlay}request(e){const t=this.overlay.post(n.MAGIC_HANDLE_REQUEST,Se(e)),r=Ge((e,r)=>{t.then(t=>{if(s(),t.hasError)r(new ue(t.payload.error));else{if(!t.hasResult)throw Ie();e(t.payload.result)}}).catch(e=>{s(),r(e)})}),s=this.overlay.on(o.MAGIC_HANDLE_EVENT,t=>{var s;const{response:n}=t.data;if(n.id===e.id&&null!=(s=n.result)&&s.event){const{event:e,params:t=[]}=n.result;r.emit(e,...t)}});return r}}class Xe extends Fe{loginWithMagicLink(t){const{email:r,showUI:s=!0,redirectURI:n}=t,o=Me(this.sdk.testMode?e.LoginWithMagicLinkTestMode:e.LoginWithMagicLink,[{email:r,showUI:s,redirectURI:n}]);return this.request(o)}loginWithSMS(t){const{phoneNumber:r}=t,s=Me(this.sdk.testMode?e.LoginWithSmsTestMode:e.LoginWithSms,[{phoneNumber:r,showUI:!0}]);return this.request(s)}loginWithCredential(t){let r=null!=t?t:"";if(!t&&"web"===ce.platform){r=window.location.search;const e=window.location.origin+window.location.pathname;window.history.replaceState(null,"",e)}const s=Me(this.sdk.testMode?e.LoginWithCredentialTestMode:e.LoginWithCredential,[r]);return this.request(s)}}let Ke;function He(e){return async(...t)=>(Ke||(Ke=await ce.configureStorage()),await Ke.ready(),Ke[e](...t))}const Ve=He("getItem"),Ye=He("setItem"),We=He("removeItem"),qe=He("clear"),Be=He("length"),Je=He("key"),ze=He("keys"),Qe=He("iterate");var Ze={__proto__:null,getItem:Ve,setItem:Ye,removeItem:We,clear:qe,length:Be,key:Je,keys:ze,iterate:Qe};function et(){const e=window.crypto.getRandomValues(new Uint8Array(16));e[6]=15&e[6]|64,e[8]=191&e[8]|128;let t="";return t+=e[0].toString(16),t+=e[1].toString(16),t+=e[2].toString(16),t+=e[3].toString(16),t+="-",t+=e[4].toString(16),t+=e[5].toString(16),t+="-",t+=e[6].toString(16),t+=e[7].toString(16),t+="-",t+=e[8].toString(16),t+=e[9].toString(16),t+="-",t+=e[10].toString(16),t+=e[11].toString(16),t+=e[12].toString(16),t+=e[13].toString(16),t+=e[14].toString(16),t+=e[15].toString(16),t}const tt="STORE_KEY_PRIVATE_KEY",rt="STORE_KEY_PUBLIC_JWK",st={name:"ECDSA",namedCurve:"P-256"},nt={name:"ECDSA",namedCurve:"P-256"};function ot(){We("STORE_KEY_PUBLIC_JWK"),We("STORE_KEY_PRIVATE_KEY")}async function it(){const e=await async function(){if(function(){const e="undefined"!=typeof window&&!!window.crypto,t=e&&!!window.crypto.subtle;return e&&t}())return await Ve("STORE_KEY_PUBLIC_JWK")||await async function(){let e=null;const{subtle:t}=window.crypto,r=await t.generateKey(st,!0,["sign"]),s=await t.exportKey("jwk",r.privateKey);e=await t.exportKey("jwk",r.publicKey);const n=await t.importKey("jwk",s,nt,!1,["sign"]);await Ye("STORE_KEY_PRIVATE_KEY",n),await Ye("STORE_KEY_PUBLIC_JWK",e)}(),Ve("STORE_KEY_PUBLIC_JWK");console.info("webcrypto is not supported")}();if(!e)return void console.info("unable to create public key or webcrypto is unsupported");const{subtle:t}=window.crypto,r=await Ve("STORE_KEY_PRIVATE_KEY");if(!r||!t)return void console.info("unable to find private key or webcrypto unsupported");const s={iat:Math.floor((new Date).getTime()/1e3),jti:et()},n=at(JSON.stringify({typ:"dpop+jwt",alg:"ES256",jwk:e})),o=at(JSON.stringify(s)),i=(a=`${n}.${o}`,(new TextEncoder).encode(a));var a;return`${n}.${o}.${function(e){let t="";return e.forEach(e=>{t+=String.fromCharCode(e)}),ct(t)}(new Uint8Array(await t.sign({name:"ECDSA",hash:{name:"SHA-256"}},r,i)))}`}function at(e){return ct(function(e){return encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(e,t)=>String.fromCharCode(parseInt(t,16)))}(e))}function ct(e){return btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+/g,"")}class lt extends Fe{getIdToken(t){const r=Me(this.sdk.testMode?e.GetIdTokenTestMode:e.GetIdToken,[t]);return this.request(r)}generateIdToken(t){const r=Me(this.sdk.testMode?e.GenerateIdTokenTestMode:e.GenerateIdToken,[t]);return this.request(r)}getMetadata(){const t=Me(this.sdk.testMode?e.GetMetadataTestMode:e.GetMetadata);return this.request(t)}updateEmail(t){const{email:r,showUI:s=!0}=t,n=Me(this.sdk.testMode?e.UpdateEmailTestMode:e.UpdateEmail,[{email:r,showUI:s}]);return this.request(n)}isLoggedIn(){const t=Me(this.sdk.testMode?e.IsLoggedInTestMode:e.IsLoggedIn);return this.request(t)}logout(){ot();const t=Me(this.sdk.testMode?e.LogoutTestMode:e.Logout);return this.request(t)}showSettings(){const t=Me(this.sdk.testMode?e.UserSettingsTestMode:e.UserSettings);return this.request(t)}}function ht(){return(ht=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e}).apply(this,arguments)}const{createBoundEmitterMethod:pt,createChainingEmitterMethod:ut}=je();class dt extends Fe{constructor(...e){super(...e),this.isMagic=!0,this.on=ut("on",this),this.once=ut("once",this),this.addListener=ut("addListener",this),this.off=ut("off",this),this.removeListener=ut("removeListener",this),this.removeAllListeners=ut("removeAllListeners",this),this.emit=pt("emit"),this.eventNames=pt("eventNames"),this.listeners=pt("listeners"),this.listenerCount=pt("listenerCount")}sendAsync(e,t){if(!t)throw ge({procedure:"Magic.rpcProvider.sendAsync",argument:1,expected:"function",received:null===t?"null":typeof t});if(Array.isArray(e))this.overlay.post(n.MAGIC_HANDLE_REQUEST,e.map(e=>{const t=Se(e);return this.prefixPayloadMethodForTestMode(t),t})).then(e=>{t(null,e.map(e=>ht({},e.payload,{error:e.hasError?new ue(e.payload.error):null})))});else{const r=Se(e);this.prefixPayloadMethodForTestMode(r),this.overlay.post(n.MAGIC_HANDLE_REQUEST,r).then(e=>{t(e.hasError?new ue(e.payload.error):null,e.payload)})}}send(e,t){if("string"==typeof e){const r=Me(e,Array.isArray(t)?t:[]);return this.request(r)}if(Array.isArray(e)||t)return void this.sendAsync(e,t);const r=_e();return r.log(),new Pe(e).applyError({code:-32603,message:r.rawMessage}).payload}enable(){const e=Me("eth_accounts");return this.request(e)}request(e){return this.prefixPayloadMethodForTestMode(e),super.request(e)}prefixPayloadMethodForTestMode(e){this.sdk.testMode&&(e.method=`testMode/eth/${e.method}`)}}function Et(e,t){return t?new URL(e,t):new URL(e)}const ft=["request","overlay","sdk"];function mt(e){let t=Object.getPrototypeOf(e);const r=[t];for(;t!==Fe.prototype;)t=Object.getPrototypeOf(t),r.push(t);return r}class vt extends Fe{constructor(){super(void 0),this.__sdk_access_field_descriptors__=new Map,this.__is_initialized__=!1,this.utils={createPromiEvent:Ge,isPromiEvent:ke,encodeJSON:Z,decodeJSON:ee,createJsonRpcRequestPayload:Me,standardizeJsonRpcRequestPayload:Se,storage:Ze};const e=[this,...mt(this)];ft.forEach(t=>{const r=e.map(e=>Object.getOwnPropertyDescriptor(e,t)),s=r.findIndex(e=>!!e),n=r[s];n&&(this.__sdk_access_field_descriptors__.set(t,{descriptor:n,isPrototypeField:s>0}),Object.defineProperty(this,t,{configurable:!0,get:()=>{throw $e(t)}}))})}init(e){this.__is_initialized__||(ft.forEach(e=>{if(this.__sdk_access_field_descriptors__.has(e)){const{descriptor:t,isPrototypeField:r}=this.__sdk_access_field_descriptors__.get(e);r?delete this[e]:Object.defineProperty(this,e,t)}}),this.sdk=e,this.__is_initialized__=!0)}createDeprecationWarning(e){const{method:t,removalVersion:r,useInstead:s}=e;return new fe(this,"DEPRECATION_NOTICE",`\`${t}\` will be removed from this Extension in version \`${r}\`.${s?` Use \`${s}\` instead.`:""}`)}createWarning(e,t){return new fe(this,e,t)}createError(e,t,r){return new Ee(this,e,t,r)}}class It extends vt{}function $t(e){return!e.compat||null==e.compat[ce.sdkName]||("string"==typeof e.compat[ce.sdkName]?K(B(ce.version),e.compat[ce.sdkName]):!!e.compat[ce.sdkName])}function yt(e){var t;const r=null!=(t=null==e?void 0:e.extensions)?t:[],s={},n=[];if(Array.isArray(r)?r.forEach(e=>{$t(e)?(e.init(this),(e.name||e.name!==It.Anonymous)&&(this[e.name]=e),e instanceof It.Internal&&(ae(e.config)||(s[e.name]=e.config))):n.push(e)}):Object.keys(r).forEach(e=>{if($t(r[e])){r[e].init(this);const t=r[e];this[e]=t,t instanceof It.Internal&&(ae(t.config)||(s[r[e].name]=t.config))}else n.push(r[e])}),n.length)throw ye(n);return s}It.Internal=class extends vt{},It.Anonymous="anonymous extension";class gt{constructor(e,t){var r;if(this.apiKey=void 0,this.endpoint=void 0,this.parameters=void 0,this.testMode=void 0,this.auth=void 0,this.user=void 0,this.rpcProvider=void 0,this.apiKey=e,!e)throw me();"react-native"===ce.platform&&null!=t&&t.endpoint&&we().log();const{defaultEndpoint:s,version:n}=ce;this.testMode=!(null==t||!t.testMode),this.endpoint=Et(null!=(r=null==t?void 0:t.endpoint)?r:s).origin,this.auth=new Xe(this),this.user=new lt(this),this.rpcProvider=new dt(this);const o=yt.call(this,t);this.parameters=Z({API_KEY:this.apiKey,DOMAIN_ORIGIN:window.location?window.location.origin:"",ETH_NETWORK:null==t?void 0:t.network,host:Et(this.endpoint).host,sdk:he[ce.sdkName],version:n,ext:ae(o)?void 0:o,locale:(null==t?void 0:t.locale)||"en_US"})}get overlay(){if(!gt.__overlays__.has(this.parameters)){const e=new ce.ViewController(this.endpoint,this.parameters);e.init(),gt.__overlays__.set(this.parameters,e)}return gt.__overlays__.get(this.parameters)}async preload(){await this.overlay.ready}}gt.__overlays__=new Map;class Rt{constructor(e,t){this.endpoint=void 0,this.parameters=void 0,this.ready=void 0,this.messageHandlers=new Set,this.endpoint=e,this.parameters=t,this.ready=this.waitForReady(),this.listen()}async post(e,t){var r=this;return Ue(async function(s){await r.ready;const n=[],i=Array.isArray(t)?t.map(e=>e.id):[],a=await async function(e,t){const r=await Ve("rt");let s;if("web"===ce.platform)try{s=await it()}catch(e){console.error("webcrypto error",e)}return s?r?{msgType:e,payload:t,jwt:s,rt:r}:{msgType:e,payload:t,jwt:s}:{msgType:e,payload:t}}(`${e}-${r.parameters}`,t);await r._post(a);const c=r.on(o.MAGIC_HANDLE_RESPONSE,(l=()=>c(),e=>{const{id:r,response:o}=function(e,t){var r;const s=null==(r=t.data.response)?void 0:r.id,n=function(e,t){return t&&Array.isArray(e)?e.find(e=>e.id===t):e}(e,s);return s&&n?{id:s,response:new Pe(n).applyResult(t.data.response.result).applyError(t.data.response.error)}:{}}(t,e);!async function(e){e.data.rt&&await Ye("rt",e.data.rt)}(e),r&&o&&Array.isArray(t)&&i.includes(r)?(n.push(o),n.length===t.length&&(l(),s(n))):r&&o&&!Array.isArray(t)&&r===t.id&&(l(),s(o))}));var l})}on(e,t){const r=t.bind(window),s=t=>{t.data.msgType===`${e}-${this.parameters}`&&r(t)};return this.messageHandlers.add(s),()=>this.messageHandlers.delete(s)}waitForReady(){return new Promise(e=>{this.on(o.MAGIC_OVERLAY_READY,()=>e())})}listen(){this.on(o.MAGIC_HIDE_OVERLAY,()=>{this.hideOverlay()}),this.on(o.MAGIC_SHOW_OVERLAY,()=>{this.showOverlay()})}}export{It as Extension,Ee as MagicExtensionError,fe as MagicExtensionWarning,ue as MagicRPCError,pe as MagicSDKError,de as MagicSDKWarning,gt as SDKBase,tt as STORE_KEY_PRIVATE_KEY,rt as STORE_KEY_PUBLIC_JWK,De as TypedEmitter,Rt as ViewController,ot as clearKeys,Oe as createDeprecationWarning,Re as createDuplicateIframeWarning,$e as createExtensionNotInitializedError,ye as createIncompatibleExtensionsError,ge as createInvalidArgumentError,it as createJwt,Ie as createMalformedResponseError,me as createMissingApiKeyError,ve as createModalNotReadyError,Ge as createPromiEvent,Ue as createPromise,we as createReactNativeEndpointConfigurationWarning,le as createSDK,_e as createSynchronousWeb3MethodWarning,je as createTypedEmitter,Et as createURL,ee as decodeJSON,Z as encodeJSON,Ae as getPayloadId,ae as isEmpty,ie as isJsonRpcErrorCode,se as isJsonRpcRequestPayload,ne as isJsonRpcResponsePayload,oe as isMagicPayloadMethod,ke as isPromiEvent,J as semver,Ze as storage,et as uuid};
//# sourceMappingURL=index.mjs.map
